CREATE SEQUENCE public_order_id_seq OWNED BY public.orders.order_id;

SELECT SETVAL('public_order_id_seq', (select max(order_id) from public.orders), false)

ALTER TABLE public.orders ALTER COLUMN order_id SET DEFAULT nextval('public_order_id_seq');

INSERT INTO purchase_details (customer_id, total_orders, total_returns, created_time)
SELECT
    o.customer_id,
    COUNT(DISTINCT o.order_id) AS total_orders,
    COUNT(DISTINCT pr.return_id) AS total_returns,
    NOW() AS created_time
FROM
    Orders o
LEFT JOIN
    Product_returns pr ON o.customer_id = pr.customer_id
GROUP BY
    o.customer_id;

INSERT INTO purchase_details (customer_id, total_orders, total_returns, created_time)
SELECT
    o.customer_id,
    (SELECT COUNT(DISTINCT order_id) FROM Orders WHERE customer_id = o.customer_id) AS total_orders,
    (SELECT COUNT(DISTINCT return_id) FROM Product_returns WHERE customer_id = o.customer_id) AS total_returns,
    NOW() AS created_time
FROM
    Orders o;


SELECT 
    o.customer_id,
    o.total_orders,
    pr.total_returns,
    NOW() AS created_time
FROM 
    (SELECT 
         customer_id,
         COUNT(DISTINCT order_id) AS total_orders
     FROM 
         Orders
     GROUP BY 
         customer_id) o
LEFT JOIN 
    (SELECT 
         customer_id,
         COUNT(DISTINCT return_id) AS total_returns
     FROM 
         Product_returns
     GROUP BY 
         customer_id) pr ON o.customer_id = pr.customer_id;